name: Daily Learning with Discord

on:
  schedule:
    - cron: '7 1 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-and-notify:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Generate daily report
      env:
        CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
      run: |
        mkdir -p reports
        python scripts/generate_report.py
        echo "TODAY=$(date +'%Y-%m-%d')" >> $GITHUB_ENV
      
    - name: Commit report
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: 'ğŸ“š í•™ìŠµ ë¦¬í¬íŠ¸ - ${{ env.TODAY }}'
        file_pattern: 'reports/*.md'
        
    - name: Send to Discord
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        # ë””ìŠ¤ì½”ë“œ ì›¹í›…ìœ¼ë¡œ ì•Œë¦¼ ì „ì†¡
        curl -H "Content-Type: application/json" \
             -X POST \
             -d '{
               "embeds": [{
                 "title": "ğŸ“š ìƒˆë¡œìš´ í•™ìŠµ ìë£Œê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!",
                 "description": "ì˜¤ëŠ˜ì˜ ì–¸ë¦¬ì–¼ ì—”ì§„ í•™ìŠµ ì£¼ì œë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.",
                 "color": 3447003,
                 "fields": [
                   {
                     "name": "ğŸ“… ë‚ ì§œ",
                     "value": "'$TODAY'",
                     "inline": true
                   },
                   {
                     "name": "ğŸ”— ë¦¬í¬íŠ¸ ë§í¬",
                     "value": "https://github.com/'${{ github.repository }}'/blob/main/reports/today.md"
                   }
                 ],
                 "footer": {
                   "text": "ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ !ì§ˆë¬¸ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”!"
                 }
               }]
             }' \
             $DISCORD_WEBHOOK_URL
